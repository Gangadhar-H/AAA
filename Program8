package practice;

class Buffer {
	int item;
	boolean isAvailable = false;
	
	synchronized void produce (int value) {
		try {
			while (isAvailable) {
				wait();
			}
			
			item = value;
			isAvailable = true;
			System.out.println("Produced item: " + item);
			notifyAll();
			
		}
		catch (InterruptedException e) {
			System.out.println("Error occured" + e);
		}
	}
	
	synchronized void consume () {
		try {
			while (!isAvailable) {
				wait();
			}
			
			System.out.println("Consumed item: " + item);
			isAvailable = false;
			notifyAll();
		} catch (InterruptedException e) {
			System.out.println("Error occured" + e);
		}
	}
	
}

class Producer extends Thread {
	Buffer buffer;
	Producer(Buffer b) {
		this.buffer = b;
	}
	public void run() {
		for (int i = 1; i < 10; i++) {
			buffer.produce(i);
			try {
				sleep(400);
			} catch(InterruptedException e) {
				e.printStackTrace();
			}
		}
	}
}

class Consumer extends Thread {
	Buffer buffer;
	Consumer(Buffer b) {
		this.buffer = b;
	}
	public void run() {
		for (int i = 1; i < 5; i++) {
			buffer.consume();
			try {
				sleep(400);
			} catch(InterruptedException e) {
				e.printStackTrace();
			}
		}
	}
}


public class Program8 {
	
	public static void main(String args[]) {
		Buffer b = new Buffer();
		Producer p = new Producer(b);
		Consumer c = new Consumer(b);
		Consumer c2 = new Consumer(b);
		System.out.println("State: " + c.getState());
		p.start();
		System.out.println("State: " + p.getState());
		c.start();
		c2.start();
		System.out.println("State: " + c.getState());
		System.out.println("State: " + c2.getState());
		
		try {
			p.join();			
		} catch(Exception e) {
			e.printStackTrace();
		}
		
		System.out.println("State: " + c.getState());
		System.out.println("State: " + p.getState());
	}
	
}
